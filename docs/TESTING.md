# Testing

## Test Layers

- **SDK unit tests** — `sdk/core`: PDA derivation, presets, config normalization, error parsing, compliance gating. No chain. Run: `npm run test:sdk` (from repo root) or `cd sdk/core && npm test`.
- **Integration tests** — Repo root `tests/`: Full lifecycle with local validator. Run: `anchor test`. Includes `sss-token.test.ts`, `sss-transfer-hook.test.ts`, and `sss-sdk.test.ts` (SDK load/mint/supply).
- **Fuzz (bonus)** — Trident or similar can be used to fuzz instruction data; document commands and invariants here when added.

## Running Tests

```bash
# SDK unit tests only (no validator)
npm run test:sdk

# Integration tests (starts validator, deploys programs, runs all test files)
anchor test
```

## Integration Test Files

- **sss-token.test.ts** — SSS-1 flow: initialize, roles, mint, burn, pause, freeze/thaw, transfer authority, error cases.
- **sss-transfer-hook.test.ts** — SSS-2 flow: initialize with hook, roles, minter quota, extra-account-metas, blacklist, seize, error cases.
- **sss-sdk.test.ts** — Uses SDK: create stablecoin with helpers, load with `SolanaStablecoin.load`, getState, getTotalSupply, mint via SDK.

## Preset / Config Tests

Unit tests in `sdk/core/tests/stablecoin.test.ts` assert that:

- `Presets.SSS_1` and `Presets.SSS_2` yield the correct three booleans.
- `normalizeInitializeParams` with custom extensions or preset override produces the expected init params.

## CI

Ensure `anchor build` runs before SDK build (IDL is generated by Anchor). Order: `anchor build` → `npm run build:sdk` → `npm run test:sdk` → `anchor test`.
